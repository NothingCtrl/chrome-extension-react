!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=87)}({1:function(e,t,n){e.exports=n(5)(225)},12:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e){var t="http://2.pik.vn/";return new Promise(function(n,o){s.default.ajax(t,{method:"POST",data:{image:e},xhrFields:{withCredentials:!0},dataType:"json"}).done(function(e,o){var r=e.saved;n(r?{url:t+r}:{})}).fail(function(e,t,n){return o(n)})})}function i(e){return new Promise(function(t){chrome.runtime.sendMessage({service:"image-upload",imageData:e},function(e){t(e)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.uploadImageToPikVn=r,t.uploadImage=i;var a=(n(4),n(2)),s=o(a)},13:function(e,t,n){"use strict";function o(e){return{getThreadTitle:function(){try{return document.querySelectorAll("td.navbar")[0].textContent.trim()}catch(e){return console.warn(e),""}},getThreadId:function(){var t=e.find("#threadtools_menu a[href*='t=']");if(t&&t.eq(0)&&t.eq(0).attr("href")){var n=t.eq(0).attr("href").match(/t=(\d+)/);if(null!==n&&n.length>0)return n[1]}return-1},getPage:function(){var t=0,n=e.find(".pagenav");return t=0===n.length?1:n.eq(0).find("tbody td.alt2 strong").text()},getLatestPost:function(){var t=e.find("table[id^='post']").last(),n=t.attr("id").match(/(\d+)/)[1],o=e.find("table[id^='post']").length;return{postNum:o,id:n}},getPostId:function(t){var n=e.find("table[id^='post']").eq(t),o=n.attr("id").match(/(\d+)/)[1];return o}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},14:function(e,t,n){e.exports=n(5)(221)},2:function(e,t,n){e.exports=n(5)(224)},29:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.peerChartBackground=t.quoteBackground=void 0,n(71);var r=n(74),i=o(r),a=n(70),s=o(a),u=n(68),c=o(u),l=n(73),f=o(l),d=n(75),h=o(d),p=n(72),g="http://128.199.183.35:3030",m=new i.default,v=new f.default(g);(0,s.default)(),(0,c.default)(),chrome.runtime.setUninstallURL("https://goo.gl/forms/hA9IzC8XRvJH7pxj2"),(0,h.default)(),chrome.tabs.onCreated.addListener(p.injectOptionalCSS),chrome.tabs.onUpdated.addListener(function(e,t,n){t.status&&"loading"===t.status&&(0,p.injectOptionalCSS)(n)}),t.quoteBackground=m,t.peerChartBackground=v},4:function(e,t,n){"use strict";function o(e){return/^\/\//.test(e)?e.replace(/^/,window.location.protocol):e}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r,a){var s=i({},e,n);fetch(o(t),s).then(function(e){s.jsonOutput===!0?e.json().then(r).catch(a):e.text().then(r).catch(a)}).catch(function(e){a(e)})})}}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},a=r({method:"get",credentials:"include"}),s=r({method:"post",credentials:"include"}),u=r({method:"put",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"})}),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,o){chrome.runtime.sendMessage({service:"proxy",url:e,options:t},function(e){return e.resolve?n(e.resolve):void o(e.reject)})})},l=new Headers;l.append("pragma","no-cache"),l.append("cache-control","no-cache"),t.PROXY_GET=c,t.GET=a,t.POST=s,t.PUT=u,t.headerNoCache=l},5:function(e,t){e.exports=common_lib},67:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=e.replace(/[\w_\/]+\.gif/g,"javascript:void(0)"),n=(0,a.default)(t),o=[],r=n.find('td > div > a[href^="showthread"]');return 0===r.length?o:(r.each(function(){try{var e=(0,a.default)(this),t=e.attr("href").match(/t=(\d+)/)[1],n=e.text(),r=e.parents("td:eq(0)").find(" > div > div  a[href^='showthread'][href*='p=']"),i=r.attr("href").match(/p=(\d+)/)[1],s=r.text(),u=r.parent();r.remove();var c=u.text().trim(),l=e.parents("td:eq(0)").find(" > div > a[href^='member'] "),f=l.text(),d=l.attr("href").match(/u=(\d+)/)[1],h=e.parents("tbody:eq(0)").find(" > tr:eq(0) td").contents().last().text().trim(),p=h.split(/[-,:]/),g=new Date(parseInt(p[2],10),parseInt(p[1]-1,10),parseInt(p[0],10),parseInt(p[3],10),parseInt(p[4],10),0);if(3===p.length){var m=["today","yesterday"],v=m.indexOf(p[0].toLowerCase());if(v>-1){var y=new Date,w=y.getDate()-v;g=new Date(parseInt(y.getFullYear(),10),y.getMonth(),w,parseInt(p[1],10),parseInt(p[2],10),0)}}o.push({author:{username:f,userid:d},thread:{title:n,id:t},post:{title:s,id:i,content:c,datetime:g.getTime()},hasRead:!1,hasSeen:!1})}catch(e){console.log(e)}}),o)}Object.defineProperty(t,"__esModule",{value:!0}),t.processQuoteHtml=r;var i=n(2),a=o(i)},68:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(){(0,a.getChromeLocalStore)(["threadTracker","followThreads"]).then(function(e){var t=e.threadTracker,n=e.followThreads,o=(new Date).getTime();return Object.keys(t).reduce(function(e,r){var i=t[r],a=o-i.lastView;return(a<c||!u.default.isUndefined(n[r]))&&(e[r]=i),e},{})}).then(function(e){(0,a.setChromeLocalStore)({threadTracker:e}).then(function(){console.info("Removed expired tracker")})})}function i(){setInterval(r,c/6)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var a=n(9),s=n(1),u=o(s),c=864e5},69:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(){return(0,s.GET)(u,{headers:s.headerNoCache}).then(function(e){var t=a.default.load(e),n=t("form[action*='subscription.php?do=dostuff']");if(0===n.length)return t.find("*:contains('You are not logged in or you do not have permission to access this page')").length>0&&console.info("Loged In = false"),!1;var o=[],r=n.find("table tr:not(:has(td.thead,td.tfoot,td.tcat))");return r.length>0?r.each(function(e,n){var r=t(n),i={};i.id=r.find("a[href*='showthread.php?t=']").eq(0).attr("href").match(/\?t=(\d+)/)[1],i.title=r.find("a[id^='thread_title']").text(),i.lastPage=function(e){var t=e.find("a[id^='thread_title']").next();if(t.length>0){var n=t.find("a").last();return n.attr("href").match(/page=(\d+)/)[1]}return 1}(r),o.push(i)}):console.info("There is no subcribed threads"),o})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var i=n(14),a=o(i),s=n(4),u="https://vozforums.com/subscription.php?do=viewsubscription"},70:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(){return(0,p.getChromeLocalStore)(["settings"]).then(function(e){var t=e.settings,n=t.delayFollowThread;return C=parseInt(n,10),(m.default.isNaN(C)||C<1||C>1440)&&(C=5),C*=6e4})}function a(e,t){e.length>0?!function(){var n=e.shift(),o=n.id,i=n.lastPage,s=n.title;(0,f.GET)("https://vozforums.com/showthread.php?t="+o+"&page="+i,{headers:f.headerNoCache}).then(function(n){try{var u=h.default.load(n);u("#ChallengForm").length>0?console.log("shit happen",u("#ChallengForm").html()):!function(){var e=(0,y.default)(u("body")),t=Object.assign({title:s,page:i},e.getLatestPost());(0,p.getChromeLocalStore)(["followThreads"]).then(function(e){var n=e.followThreads;(0,p.setChromeLocalStore)({followThreads:l({},n,r({},o,t))})})}()}catch(e){console.error(e)}setTimeout(a.bind(null,e,t),S)}).catch(function(n){console.log(n),setTimeout(a.bind(null,e,t),5*S)})}():t()}function s(e){return(0,p.getChromeLocalStore)(["followThreads"]).then(function(t){var n=t.followThreads,o=e.map(function(e){return e.id}),r=Object.keys(n).reduce(function(e,t){return o.indexOf(t)>-1&&(e[t]=n[t]),e},{});return(0,p.setChromeLocalStore)({followThreads:r}),e})}function u(){console.log("Start to update subscribed thread"),i().then(b.default).then(s).then(function(e){return new Promise(function(t){return a(e,t)})}).then(function(){console.info("subscribed threads updated"),setTimeout(u,C)}).catch(function(e){console.error(e),console.info("Error while trying to get subscribed thread, try again next time ..."),setTimeout(u,C)})}function c(){u()}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};t.default=c;var f=n(4),d=n(14),h=o(d),p=n(9),g=n(1),m=o(g),v=n(13),y=o(v),w=n(69),b=o(w),k=3e5,S=1e3,C=k},71:function(e,t,n){"use strict";!function(e,t,n,o,r,i,a){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=o,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-98781531-1","auto"),ga("set","transport","beacon"),ga("set","checkProtocolTask",function(){}),ga("send","pageview"),window.trackEvent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown",n=arguments[2];ga("send","event",e,t,n),console.info("ga","_trackEvent",e,t,n)},trackEvent("test2","test2-2"),chrome.runtime.onMessage.addListener(function(e){e.__ga===!0&&trackEvent(e.category,e.action,e.label)})},72:function(e,t,n){"use strict";function o(e){console.log(e.id),chrome.tabs.insertCSS(e.id,{code:i.map(function(e){return e.css}).join("\n"),runAt:"document_start"})}function r(e){if(e.wideScreen===!0)i.push({name:"wideScreen",css:".page{\n        box-shadow: none;\n        width: 100% !important;\n        transition: all 0.3s;\n        max-width: 5000px !important;\n      }"});else do i.splice(i.findIndex(function(e){return"wideScreen"===e.name}),1);while(i.findIndex(function(e){return"wideScreen"===e.name})>-1)}var i=[];chrome.storage.local.get("settings",function(e){r(e.settings)}),chrome.storage.onChanged.addListener(function(e,t){e.settings&&r(e.settings.newValue)}),e.exports={optionalCSS:i,injectOptionalCSS:o}},73:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(83),a=n(84),s=function(){function e(t){var n=this;o(this,e),this.socket=null,this.p2p=null,this.url=t,this.numClients=100,chrome.runtime.onMessage.addListener(function(e){e.peerChatSendMessage&&n.sendPeerMessage(e.peerChatSendMessage),e.peerChatConnect&&(n.log("Connect"),n.connect()),e.peerChatDisconnect&&(n.log("Disconnect"),n.disconnect())})}return r(e,[{key:"connect",value:function(){var e=this;this.url&&null===this.socket&&null===this.p2p&&(this.socket=i(this.url),this.p2p=new a(this.socket,{numClients:this.numClients},function(){e.p2p.emit("peer-obj",{peerId:e.p2p.peerId})}),this.socket.on("disconnect",function(){return e.log("Socket Disconnected")}),this.p2p.on("peer-msg",function(t){e.log("Receive Chat Message",t.message),e.receivePeerMessage(t.message)}))}},{key:"disconnect",value:function(){this.socket&&this.p2p&&(this.p2p.disconnect(),this.socket.disconnect(),this.p2p=null,this.socket=null)}},{key:"sendPeerMessage",value:function(e){this.p2p&&(this.log("Send Message",e),this.p2p.emit("peer-msg",{message:e}))}},{key:"receivePeerMessage",value:function(e){chrome.tabs.query({url:"*://vozforums.com/*"},function(t){t.forEach(function(t){chrome.tabs.sendMessage(t.id,{peerChatIncomeMessage:e})})})}},{key:"joinRoom",value:function(e){this.socket&&(this.log("Join Room",e),this.socket.emit("join-room",e))}},{key:"log",value:function(){arguments[0]="[VOZliving] "+arguments[0],console.log.apply(console,arguments)}}]),e}();e.exports=s},74:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(4),s=n(67),u=n(9),c=n(1),l=o(c),f=function(){function e(){var t=this;r(this,e),this.hasNotify=!1,this.checkGetQuotes(),chrome.runtime.onMessage.addListener(function(e){e.continueNotify&&e.continueNotify===!0&&(t.hasNotify=!1)})}return i(e,[{key:"getQuoteList",value:function(e){return new Promise(function(t){var n=e.isLogin,o=e.username,r=e.token;if(n){var i="https://vozforums.com/search.php",u=new FormData;u.append("do","process"),u.append("quicksearch",1),u.append("childforums",1),u.append("exactname",1),u.append("securitytoken",r),u.append("query",o),u.append("showposts",1),(0,a.POST)(i,{body:u}).then(function(e){var n=(0,s.processQuoteHtml)(e);t(n)}).catch(function(){t([])})}else t([])})}},{key:"updateQuotes",value:function(e){var t=this,n=!1;(0,u.getChromeLocalStore)(["quotes"]).then(function(o){var r=o.quotes;r&&0!==r.length?(e.forEach(function(e){var t=r.find(function(t){return t.post.id==e.post.id});l.default.isUndefined(t)?n=!0:e.hasSeen=!0}),n&&t.saveQuotes(e)):t.saveQuotes(e)})}},{key:"saveQuotes",value:function(e){var t=this;(0,u.setChromeLocalStore)({quotes:e}).then(function(){chrome.tabs.query({url:"*://vozforums.com/*"},function(t){t.forEach(function(t){chrome.tabs.sendMessage(t.id,{quotes:e})})});var n=l.default.filter(e,{hasSeen:!1});n.length>0&&t.hasNotify===!1&&(chrome.notifications.create("voz-living",{type:"basic",title:"VOZLiving",message:"Bạn có "+n.length+" quote(s) chưa đọc.",iconUrl:"../assert/icon/64.png"}),t.hasNotify=!0)})}},{key:"checkGetQuotes",value:function(){var e=this;console.log("VOZliving check quotes"),(0,u.getChromeLocalStore)(["authInfo","settings"]).then(function(t){var n=t.settings,o=t.authInfo,r=n.notifyQuote,i=n.delay,a=void 0===i?10:i,s=""!==a?a:1;s=parseInt(s,10)>1?parseInt(s,10):1,r&&!l.default.isEmpty(o)?e.getQuoteList(o).then(function(t){e.updateQuotes(t),setTimeout(function(){return e.checkGetQuotes()},60*s*1e3)}):setTimeout(function(){return e.checkGetQuotes()},60*s*1e3)})}}]),e}();t.default=f},75:function(e,t,n){"use strict";function o(e,t){(0,s.uploadImageToPikVn)(e.imageData).then(function(e){t(e)})}function r(e,t){var n=e.url,o=e.options;(0,u.GET)(n,o).then(function(e){return t({resolve:e})}).catch(function(e){return t({reject:e})})}function i(e,t){(new Date).getTime()>l.ts+2e4?(l.ts=(new Date).getTime(),(0,u.GET)(c,{credentials:"same-origin"}).then(function(e){var n=e;"string"==typeof e&&(n=JSON.parse(e)),l.data=n.rows,l.ts=(new Date).getTime(),t(n.rows)})):t(l.data)}function a(){chrome.runtime.onMessage.addListener(function(e,t,n){if(console.log(t.tab?"from a content script:"+t.tab.url:"from the extension"),e.service){if("image-upload"===e.service)return o(e,n),!0;if("open-options"===e.service)return chrome.runtime.openOptionsPage(),!0;if("proxy"===e.service)return r(e,n),!0;if("request-hotthreads"===e.service)return i(e,n),!0}})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var s=n(12),u=n(4),c="https://voz-living.appspot.com/query?id=agxzfnZvei1saXZpbmdyFQsSCEFwaVF1ZXJ5GICAgICA5JEKDA&format=json",l={data:{},ts:(new Date).getTime()}},83:function(e,t,n){e.exports=n(5)(232)},84:function(e,t,n){e.exports=n(5)(233)},87:function(e,t,n){"use strict";n(29)},9:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.setChromeSyncStore=t.getChromeSyncStore=t.setChromeLocalStore=t.getChromeLocalStore=t.defaultStoreStructure=void 0;var r=n(1),i=o(r),a=t.defaultStoreStructure={settings:{wideScreen:!0,wideScreenSpecial:!1,threadPreview:!0,adsRemove:!0,linkHelper:!0,notifyQuote:!0,emotionHelper:!0,minimizeQuote:!0,quickPostQuotation:!0,reloadButton:!0,autoGotoNewthread:!1,savePostEnable:!0,autoHideSidebar:!1,peerChatEnable:!1,capturePostEnable:!0,LinhXinhBtn:!0,userStyle:"",delay:1,delayFollowThread:5},authInfo:{},quotes:[],quickLinks:[{id:"voz_living_f17",label:"F17",link:"https://vozforums.com/forumdisplay.php?f=17"},{id:"voz_living_f33",label:"F33",link:"https://vozforums.com/forumdisplay.php?f=33"}],followThreads:{},threadTracker:{},currentPost:{}},s={savedPosts:{}};t.default=a;var u=i.default.keys(a),c=t.getChromeLocalStore=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;return new Promise(function(o){chrome.storage[t].get(e,function(t){i.default.isEmpty(t)?!function(){var t={},r=e;i.default.isString(r)&&(r=[r]),r.forEach(function(e){t[e]=n[e]}),o(t)}():!function(){var r=t;e.forEach(function(e){i.default.isUndefined(r[e])&&(r[e]=n[e])}),o(r)}()})})},l=t.setChromeLocalStore=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local";return new Promise(function(n){chrome.storage[t].set(e,function(){return n(!0)})})};t.getChromeSyncStore=function(e){return c(e,"sync",s)},t.setChromeSyncStore=function(e){return l(e,"sync")}}});