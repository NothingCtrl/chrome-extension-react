!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=83)}({1:function(e,t,n){e.exports=n(5)(224)},12:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e){var t="http://2.pik.vn/";return new Promise(function(n,o){u.default.ajax(t,{method:"POST",data:{image:e},xhrFields:{withCredentials:!0},dataType:"json"}).done(function(e,o){var r=e.saved;n(r?{url:t+r}:{})}).fail(function(e,t,n){return o(n)})})}function a(e){return new Promise(function(t){chrome.runtime.sendMessage({service:"image-upload",imageData:e},function(e){t(e)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.uploadImageToPikVn=r,t.uploadImage=a;var i=(n(4),n(1)),u=o(i)},13:function(e,t,n){"use strict";function o(e){return{getThreadTitle:function(){try{return document.querySelectorAll("td.navbar")[0].textContent.trim()}catch(e){return console.warn(e),""}},getThreadId:function(){var t=e.find("#threadtools_menu a[href*='t=']");if(t&&t.eq(0)&&t.eq(0).attr("href")){var n=t.eq(0).attr("href").match(/t=(\d+)/);if(null!==n&&n.length>0)return n[1]}return-1},getPage:function(){var t=0,n=e.find(".pagenav");return t=0===n.length?1:n.eq(0).find("tbody td.alt2 strong").text()},getLatestPost:function(){var t=e.find("table[id^='post']").last(),n=t.attr("id").match(/(\d+)/)[1],o=e.find("table[id^='post']").length;return{postNum:o,id:n}},getPostId:function(t){var n=e.find("table[id^='post']").eq(t),o=n.attr("id").match(/(\d+)/)[1];return o}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},14:function(e,t,n){e.exports=n(5)(221)},2:function(e,t,n){e.exports=n(5)(225)},27:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.peerChartBackground=t.quoteBackground=void 0,n(68);var r=n(70),a=o(r),i=n(67),u=o(i),s=n(65),c=o(s),l=n(69),f=o(l),d=n(71),h=o(d),p="http://128.199.183.35:3030",v=new a.default,g=new f.default(p);(0,u.default)(),(0,c.default)(),chrome.runtime.setUninstallURL("https://goo.gl/forms/hA9IzC8XRvJH7pxj2"),(0,h.default)(),t.quoteBackground=v,t.peerChartBackground=g},4:function(e,t,n){"use strict";function o(e){return/^\/\//.test(e)?e.replace(/^/,window.location.protocol):e}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r,i){var u=a({},e,n);fetch(o(t),u).then(function(e){u.jsonOutput===!0?e.json().then(r).catch(i):e.text().then(r).catch(i)}).catch(function(e){i(e)})})}}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},i=r({method:"get",credentials:"include"}),u=r({method:"post",credentials:"include"}),s=r({method:"put",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"})}),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,o){chrome.runtime.sendMessage({service:"proxy",url:e,options:t},function(e){return e.resolve?n(e.resolve):void o(e.reject)})})},l=new Headers;l.append("pragma","no-cache"),l.append("cache-control","no-cache"),t.PROXY_GET=c,t.GET=i,t.POST=u,t.PUT=s,t.headerNoCache=l},5:function(e,t){e.exports=common_lib},64:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=e.replace(/[\w_\/]+\.gif/g,"javascript:void(0)"),n=(0,i.default)(t),o=[],r=n.find('td > div > a[href^="showthread"]');return 0===r.length?o:(r.each(function(){try{var e=(0,i.default)(this),t=e.attr("href").match(/t=(\d+)/)[1],n=e.text(),r=e.parents("td:eq(0)").find(" > div > div  a[href^='showthread'][href*='p=']"),a=r.attr("href").match(/p=(\d+)/)[1],u=r.text(),s=r.parent();r.remove();var c=s.text().trim(),l=e.parents("td:eq(0)").find(" > div > a[href^='member'] "),f=l.text(),d=l.attr("href").match(/u=(\d+)/)[1],h=e.parents("tbody:eq(0)").find(" > tr:eq(0) td").contents().last().text().trim(),p=h.split(/[-,:]/),v=new Date(parseInt(p[2],10),parseInt(p[1]-1,10),parseInt(p[0],10),parseInt(p[3],10),parseInt(p[4],10),0);if(3===p.length){var g=["today","yesterday"],m=g.indexOf(p[0].toLowerCase());if(m>-1){var y=new Date,b=y.getDate()-m;v=new Date(parseInt(y.getFullYear(),10),y.getMonth(),b,parseInt(p[1],10),parseInt(p[2],10),0)}}o.push({author:{username:f,userid:d},thread:{title:n,id:t},post:{title:u,id:a,content:c,datetime:v.getTime()},hasRead:!1,hasSeen:!1})}catch(e){console.log(e)}}),o)}Object.defineProperty(t,"__esModule",{value:!0}),t.processQuoteHtml=r;var a=n(1),i=o(a)},65:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(){(0,i.getChromeLocalStore)(["threadTracker","followThreads"]).then(function(e){var t=e.threadTracker,n=e.followThreads,o=(new Date).getTime();return Object.keys(t).reduce(function(e,r){var a=t[r],i=o-a.lastView;return(i<c||!s.default.isUndefined(n[r]))&&(e[r]=a),e},{})}).then(function(e){(0,i.setChromeLocalStore)({threadTracker:e}).then(function(){console.info("Removed expired tracker")})})}function a(){setInterval(r,c/6)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var i=n(9),u=n(2),s=o(u),c=864e5},66:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(){return(0,u.GET)(s,{headers:u.headerNoCache}).then(function(e){var t=i.default.load(e),n=t("form[action*='subscription.php?do=dostuff']");if(0===n.length)return t.find("*:contains('You are not logged in or you do not have permission to access this page')").length>0&&console.info("Loged In = false"),!1;var o=[],r=n.find("table tr:not(:has(td.thead,td.tfoot,td.tcat))");return r.length>0?r.each(function(e,n){var r=t(n),a={};a.id=r.find("a[href*='showthread.php?t=']").eq(0).attr("href").match(/\?t=(\d+)/)[1],a.title=r.find("a[id^='thread_title']").text(),a.lastPage=function(e){var t=e.find("a[id^='thread_title']").next();if(t.length>0){var n=t.find("a").last();return n.attr("href").match(/page=(\d+)/)[1]}return 1}(r),o.push(a)}):console.info("There is no subcribed threads"),o})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var a=n(14),i=o(a),u=n(4),s="https://vozforums.com/subscription.php?do=viewsubscription"},67:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(){return(0,p.getChromeLocalStore)(["settings"]).then(function(e){var t=e.settings,n=t.delayFollowThread;return P=parseInt(n,10),(g.default.isNaN(P)||P<1||P>1440)&&(P=5),P*=6e4})}function i(e,t){e.length>0?!function(){var n=e.shift(),o=n.id,a=n.lastPage,u=n.title;(0,f.GET)("https://vozforums.com/showthread.php?t="+o+"&page="+a,{headers:f.headerNoCache}).then(function(n){try{var s=h.default.load(n);s("#ChallengForm").length>0?console.log("shit happen",s("#ChallengForm").html()):!function(){var e=(0,y.default)(s("body")),t=Object.assign({title:u,page:a},e.getLatestPost());(0,p.getChromeLocalStore)(["followThreads"]).then(function(e){var n=e.followThreads;(0,p.setChromeLocalStore)({followThreads:l({},n,r({},o,t))})})}()}catch(e){console.error(e)}setTimeout(i.bind(null,e,t),_)}).catch(function(n){console.log(n),setTimeout(i.bind(null,e,t),5*_)})}():t()}function u(e){return(0,p.getChromeLocalStore)(["followThreads"]).then(function(t){var n=t.followThreads,o=e.map(function(e){return e.id}),r=Object.keys(n).reduce(function(e,t){return o.indexOf(t)>-1&&(e[t]=n[t]),e},{});return(0,p.setChromeLocalStore)({followThreads:r}),e})}function s(){console.log("Start to update subscribed thread"),a().then(w.default).then(u).then(function(e){return new Promise(function(t){return i(e,t)})}).then(function(){console.info("subscribed threads updated"),setTimeout(s,P)}).catch(function(e){console.error(e),console.info("Error while trying to get subscribed thread, try again next time ..."),setTimeout(s,P)})}function c(){s()}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};t.default=c;var f=n(4),d=n(14),h=o(d),p=n(9),v=n(2),g=o(v),m=n(13),y=o(m),b=n(66),w=o(b),k=3e5,_=1e3,P=k},68:function(e,t,n){"use strict";!function(e,t,n,o,r,a,i){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,a=t.createElement(n),i=t.getElementsByTagName(n)[0],a.async=1,a.src=o,i.parentNode.insertBefore(a,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-98781531-1","auto"),ga("set","transport","beacon"),ga("set","checkProtocolTask",function(){}),ga("send","pageview"),window.trackEvent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown",n=arguments[2];ga("send","event",e,t,n),console.info("ga","_trackEvent",e,t,n)},trackEvent("test2","test2-2"),chrome.runtime.onMessage.addListener(function(e){e.__ga===!0&&trackEvent(e.category,e.action,e.label)})},69:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(79),i=n(80),u=function(){function e(t){var n=this;o(this,e),this.socket=null,this.p2p=null,this.url=t,this.numClients=100,chrome.runtime.onMessage.addListener(function(e){e.peerChatSendMessage&&n.sendPeerMessage(e.peerChatSendMessage),e.peerChatConnect&&(n.log("Connect"),n.connect()),e.peerChatDisconnect&&(n.log("Disconnect"),n.disconnect())})}return r(e,[{key:"connect",value:function(){var e=this;this.url&&null===this.socket&&null===this.p2p&&(this.socket=a(this.url),this.p2p=new i(this.socket,{numClients:this.numClients},function(){e.p2p.emit("peer-obj",{peerId:e.p2p.peerId})}),this.socket.on("disconnect",function(){return e.log("Socket Disconnected")}),this.p2p.on("peer-msg",function(t){e.log("Receive Chat Message",t.message),e.receivePeerMessage(t.message)}))}},{key:"disconnect",value:function(){this.socket&&this.p2p&&(this.p2p.disconnect(),this.socket.disconnect(),this.p2p=null,this.socket=null)}},{key:"sendPeerMessage",value:function(e){this.p2p&&(this.log("Send Message",e),this.p2p.emit("peer-msg",{message:e}))}},{key:"receivePeerMessage",value:function(e){chrome.tabs.query({url:"*://vozforums.com/*"},function(t){t.forEach(function(t){chrome.tabs.sendMessage(t.id,{peerChatIncomeMessage:e})})})}},{key:"joinRoom",value:function(e){this.socket&&(this.log("Join Room",e),this.socket.emit("join-room",e))}},{key:"log",value:function(){arguments[0]="[VOZliving] "+arguments[0],console.log.apply(console,arguments)}}]),e}();e.exports=u},70:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(4),u=n(64),s=n(9),c=n(2),l=o(c),f=function(){function e(){var t=this;r(this,e),this.hasNotify=!1,this.checkGetQuotes(),chrome.runtime.onMessage.addListener(function(e){e.continueNotify&&e.continueNotify===!0&&(t.hasNotify=!1)})}return a(e,[{key:"getQuoteList",value:function(e){return new Promise(function(t){var n=e.isLogin,o=e.username,r=e.token;if(n){var a="https://vozforums.com/search.php",s=new FormData;s.append("do","process"),s.append("quicksearch",1),s.append("childforums",1),s.append("exactname",1),s.append("securitytoken",r),s.append("query",o),s.append("showposts",1),(0,i.POST)(a,{body:s}).then(function(e){var n=(0,u.processQuoteHtml)(e);t(n)}).catch(function(){t([])})}else t([])})}},{key:"updateQuotes",value:function(e){var t=this,n=!1;(0,s.getChromeLocalStore)(["quotes"]).then(function(o){var r=o.quotes;r&&0!==r.length?(e.forEach(function(e){var t=r.find(function(t){return t.post.id==e.post.id});l.default.isUndefined(t)?n=!0:e.hasSeen=!0}),n&&t.saveQuotes(e)):t.saveQuotes(e)})}},{key:"saveQuotes",value:function(e){var t=this;(0,s.setChromeLocalStore)({quotes:e}).then(function(){chrome.tabs.query({url:"*://vozforums.com/*"},function(t){t.forEach(function(t){chrome.tabs.sendMessage(t.id,{quotes:e})})});var n=l.default.filter(e,{hasSeen:!1});n.length>0&&t.hasNotify===!1&&(chrome.notifications.create("voz-living",{type:"basic",title:"VOZLiving",message:"Bạn có "+n.length+" quote(s) chưa đọc.",iconUrl:"../assert/icon/64.png"}),t.hasNotify=!0)})}},{key:"checkGetQuotes",value:function(){var e=this;console.log("VOZliving check quotes"),(0,s.getChromeLocalStore)(["authInfo","settings"]).then(function(t){var n=t.settings,o=t.authInfo,r=n.notifyQuote,a=n.delay,i=void 0===a?10:a,u=""!==i?i:1;u=parseInt(u,10)>1?parseInt(u,10):1,r&&!l.default.isEmpty(o)?e.getQuoteList(o).then(function(t){e.updateQuotes(t),setTimeout(function(){return e.checkGetQuotes()},60*u*1e3)}):setTimeout(function(){return e.checkGetQuotes()},60*u*1e3)})}}]),e}();t.default=f},71:function(e,t,n){"use strict";function o(e,t){(0,i.uploadImageToPikVn)(e.imageData).then(function(e){t(e)})}function r(e,t){var n=e.url,o=e.options;(0,u.GET)(n,o).then(function(e){return t({resolve:e})}).catch(function(e){return t({reject:e})})}function a(){chrome.runtime.onMessage.addListener(function(e,t,n){if(console.log(t.tab?"from a content script:"+t.tab.url:"from the extension"),e.service){if("image-upload"===e.service)return o(e,n),!0;if("open-options"===e.service)return chrome.runtime.openOptionsPage(),!0;if("proxy"===e.service)return r(e,n),!0}})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var i=n(12),u=n(4)},79:function(e,t,n){e.exports=n(5)(232)},80:function(e,t,n){e.exports=n(5)(233)},83:function(e,t,n){"use strict";n(27)},9:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.setChromeSyncStore=t.getChromeSyncStore=t.setChromeLocalStore=t.getChromeLocalStore=t.defaultStoreStructure=void 0;var r=n(2),a=o(r),i=t.defaultStoreStructure={settings:{wideScreen:!0,threadPreview:!0,adsRemove:!0,linkHelper:!0,notifyQuote:!0,emotionHelper:!0,minimizeQuote:!0,quickPostQuotation:!0,reloadButton:!0,autoGotoNewthread:!1,savePostEnable:!0,autoHideSidebar:!1,peerChatEnable:!1,capturePostEnable:!0,userStyle:"",delay:1,delayFollowThread:5},authInfo:{},quotes:[],quickLinks:[{id:"voz_living_f17",label:"F17",link:"https://vozforums.com/forumdisplay.php?f=17"},{id:"voz_living_f33",label:"F33",link:"https://vozforums.com/forumdisplay.php?f=33"}],followThreads:{},threadTracker:{},currentPost:{}},u={savedPosts:{}};t.default=i;var s=a.default.keys(i),c=t.getChromeLocalStore=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;return new Promise(function(o){chrome.storage[t].get(e,function(t){a.default.isEmpty(t)?!function(){var t={},r=e;a.default.isString(r)&&(r=[r]),r.forEach(function(e){t[e]=n[e]}),o(t)}():!function(){var r=t;e.forEach(function(e){a.default.isUndefined(r[e])&&(r[e]=n[e])}),o(r)}()})})},l=t.setChromeLocalStore=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local";return new Promise(function(n){chrome.storage[t].set(e,function(){return n(!0)})})};t.getChromeSyncStore=function(e){return c(e,"sync",u)},t.setChromeSyncStore=function(e){return l(e,"sync")}}});